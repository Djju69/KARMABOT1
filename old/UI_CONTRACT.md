# 🎯 UI-КОНТРАКТ KARMABOT1

**Дата утверждения:** 09.09.2025 12:00  
**Статус:** ✅ ЗАМОРОЖЕН - НЕ ПОДЛЕЖИТ ИЗМЕНЕНИЯМ БЕЗ СОГЛАСОВАНИЯ

---

## ⛔ **КРИТИЧЕСКОЕ ПРЕДУПРЕЖДЕНИЕ**

> **UI-Контракт заморожен.**  
> Структура меню и кнопок утверждена и не подлежит изменениям без отдельного согласования.  
> Reply-клавиатуры — только из `reply_v2.py`.  
> Inline — только по контексту.  
> Новые кнопки запрещены без запроса на изменение UI.

---

## 🎯 **ТИПЫ КЛАВИАТУР**

### **ReplyKeyboardMarkup** 
- ✅ Для всех основных меню и кабинетов пользователей
- ✅ Отображаются снизу, всегда видимы
- ✅ Единственный источник: `core/keyboards/reply_v2.py`

### **InlineKeyboardMarkup**
- ✅ Только для специальных действий
- ✅ Временные, встроенные в сообщение
- ✅ Создаются локально в `handlers/`, `windows/`, `states/`

---

## 👤 **ПОЛЬЗОВАТЕЛЬ (User)**

### **Главное меню (Reply):**
```
[🗂️ Категории] [👥 Пригласить друзей]
[⭐ Избранные] [❓ Помощь]
[👤 Личный кабинет]
```

### **Личный кабинет (Reply):**
```
[📊 Моя карма] [💳 Мои карты]
[💎 Мои баллы] [🏪 Каталог мест]
[🏆 Достижения] [📋 История]
[🔔 Уведомления] [🌐 Язык]
[🤝 Стать партнёром] [❓ Помощь]
[◀️ Назад]
```

---

## 🧑‍💼 **ПАРТНЁР (Partner)**

### **Главное меню:**
- То же, что у пользователя

### **Кабинет партнёра (Reply):**
```
[📷 Сканировать QR]
[➕ Добавить карточку] [📋 Мои карточки]
[📊 Статистика] [⚙️ Настройки]
[🌐 Язык]
[◀️ Назад]
```

---

## 🛡️ **АДМИН (Admin)**

### **Главное меню (Reply):**
```
[🗂️ Категории] [📍 Показать ближайшие]
[🌐 Выбор языка]
[👤 Личный кабинет]
[❓ Помощь]
[Админ кабинет]
```

### **Админ кабинет (Reply):**
```
[📋 Модерация] [🔍 Поиск]
[📊 Статистика] [👥 Пользователи]
[💬 Рассылка] [⚙️ Настройки лояльности]
[🌐 Язык]
[◀️ Назад]
```

---

## 👑 **СУПЕР-АДМИН (SuperAdmin)**

### **Главное меню (Reply):**
```
[🗂️ Категории] [📍 Показать ближайшие]
[📊 Дашборд: Модерация(0) | Уведомления(0) | Система(OK)]
[👑 Админ кабинет]
```

### **Супер-админ кабинет (Reply):**
```
[📋 Модерация] [👥 Админы]
[🔍 Поиск] [📊 Статистика]
[👥 Пользователи] [🤝 Партнёры]
[🧾 Карты] [💬 Рассылка]
[⚙️ Настройки лояльности] [🗑️ Удаление]
[🌐 Язык]
[◀️ Назад]
```

---

## 🌐 **ОБЯЗАТЕЛЬНОЕ ПРАВИЛО: КНОПКА "ЯЗЫК"**

### **Критические требования:**
- ✅ **ПРИСУТСТВУЕТ В КАЖДОМ ЛИЧНОМ КАБИНЕТЕ** всех участников
- ✅ **Располагается в нижней части** кабинета, но всегда отображается
- ✅ **Использует ReplyKeyboardMarkup**
- ✅ **Открывает меню смены языка** с выбором: 🇷🇺 / 🇺🇸 / 🇻🇳 / 🇰🇷
- ✅ **Использует i18n** и функцию `set_language(user_id, lang_code)`
- ✅ **Переключает интерфейс** на выбранный язык без перезапуска бота
- ✅ **Доступна с любого устройства** и роли

### **⛔ Запрещено:**
- ❌ Удалять кнопку "Язык"
- ❌ Делать её только в одном кабинете
- ❌ Переносить её в Inline клавиатуру

---

## 🔧 **ДОПОЛНИТЕЛЬНЫЕ REPLY-КЛАВИАТУРЫ**

### **Категории:**
```
[🍽 Рестораны] [🧖‍♀️ SPA]
[🚗 Транспорт] [🏨 Отели]
[🚶‍♂️ Экскурсии] [🛍️ Магазины]
[◀️ Назад в главное меню]
```

### **Подкатегории ресторанов:**
```
[🍜 Азиатская кухня] [🍝 Европейская кухня]
[🍟 Фастфуд] [🥗 Вегетарианская]
[🔎 Показать все]
[◀️ К категориям]
```

### **Выбор языка (Reply):**
```
[🇷🇺 Русский] [🇺🇸 English]
[🇻🇳 Tiếng Việt] [🇰🇷 한국어]
[◀️ Назад в главное меню]
```

---

## 🔁 **INLINE-КЛАВИАТУРЫ (только для спец-функций)**

### **Используются строго для:**
- ✅ **Фильтров карточек** (например, кухня, статус и т.д.)
- ✅ **Пагинации карточек** (⬅️ 1/5 ➡️)
- ✅ **Выбора города** (🌆 Нячанг, Дананг, Фукуок и т.д.)
- ✅ **Модерации** (✔️ Одобрить / ❌ Отклонить)
- ✅ **WebApp кнопок** (открытие WebApp по URL)
- ✅ **Принятия политики** конфиденциальности

### **❌ Запрещено:**
- ❌ Inline-дубликаты фильтров (с галочками ✅) — удалены
- ❌ Использовать Inline для постоянных меню
- ❌ Создавать Inline для основных навигационных кнопок

---

## 🧩 **ФАЙЛ-КОНТРАКТ**

### **✅ Единственный источник всех Reply-кнопок:**
- `core/keyboards/reply_v2.py`

### **✅ Inline-кнопки:**
- Создаются локально в `handlers/`, `windows/`, `states/`
- По месту использования

---

## ⚠️ **ПРАВИЛА СОБЛЮДЕНИЯ UI-КОНТРАКТА**

### **❌ НЕ создавать:**
- Новых Reply-файлов — всё только в `reply_v2.py`
- Дубликатов FSM, callback'ов, клавиатур
- Inline-дубликатов для постоянных меню

### **✅ ОБЯЗАТЕЛЬНО:**
- Перед любой реализацией — проверить, есть ли уже код
- Inline – только для временных действий
- Reply – для постоянных меню и кабинетов
- Кнопка "🌐 Язык" в каждом кабинете

---

## 📋 **ПОДДЕРЖИВАЕМЫЕ ЯЗЫКИ**

- 🇷🇺 **Русский** (ru) - основной
- 🇺🇸 **English** (en)
- 🇻🇳 **Tiếng Việt** (vi)
- 🇰🇷 **한국어** (ko)

Все тексты кнопок и сообщений поддерживают i18n через `core/utils/locales_v2.py`.

---

## 🔄 **ПРОЦЕДУРА ИЗМЕНЕНИЙ**

Если требуется изменение UI:

1. **Создать RFC** (Request for Change)
2. **Получить письменное согласование** СуперАдмина
3. **Реализовать за фича-флагом** (выключенным по умолчанию)
4. **Протестировать** на всех ролях и языках
5. **Получить финальное одобрение** для включения

---

**Контракт утверждён и заморожен. Нарушения недопустимы.**
