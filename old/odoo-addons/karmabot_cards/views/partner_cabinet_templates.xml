<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Partner Cabinet Login Template -->
    <template id="partner_cabinet_login" name="KarmaBot Partner Cabinet Login">
        <t t-call="web.layout">
            <t t-set="title">KarmaBot - Partner Cabinet</t>
            <div class="container mt-4">
                <div class="row justify-content-center">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="text-center">üè¢ KarmaBot Partner Cabinet</h3>
                            </div>
                            <div class="card-body">
                                <t t-if="error">
                                    <div class="alert alert-danger" role="alert">
                                        <strong>Error:</strong> <t t-esc="error"/>
                                    </div>
                                </t>
                                <div class="text-center">
                                    <p class="mb-4">Please access your partner cabinet through the Telegram bot.</p>
                                    <a href="https://t.me/your_bot_username" class="btn btn-primary btn-lg">
                                        <i class="fa fa-telegram"></i> Open Telegram Bot
                                    </a>
                                </div>
                                <hr/>
                                <div class="text-center">
                                    <small class="text-muted">
                                        Not a partner yet? 
                                        <a href="https://t.me/your_bot_username">Apply here</a>
                                    </small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </t>
    </template>
    
    <!-- Partner Cabinet Main Template -->
    <template id="partner_cabinet" name="KarmaBot Partner Cabinet">
        <t t-call="web.layout">
            <t t-set="title">KarmaBot - Partner Dashboard</t>
            <div class="container mt-4">
                <!-- Header -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card bg-success text-white">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col-md-8">
                                        <h2 class="mb-1">
                                            <i class="fa fa-building"></i> 
                                            <t t-esc="partner.name"/>
                                        </h2>
                                        <p class="mb-0">
                                            <i class="fa fa-telegram"></i> 
                                            @<t t-esc="partner.telegram_username or 'No username'"/>
                                        </p>
                                    </div>
                                    <div class="col-md-4 text-right">
                                        <h3 class="mb-1">
                                            <t t-esc="stats.total_cards"/>
                                            <small>cards</small>
                                        </h3>
                                        <p class="mb-0">
                                            <t t-esc="stats.total_scans"/> scans
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h4 class="text-primary">
                                    <t t-esc="stats.published_cards"/>
                                </h4>
                                <p class="mb-0">Published Cards</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h4 class="text-warning">
                                    <t t-esc="stats.pending_cards"/>
                                </h4>
                                <p class="mb-0">Pending Moderation</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h4 class="text-info">
                                    <t t-esc="stats.total_views"/>
                                </h4>
                                <p class="mb-0">Total Views</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h4 class="text-success">
                                    <t t-esc="stats.total_scans"/>
                                </h4>
                                <p class="mb-0">Total Scans</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fa fa-bolt"></i> Quick Actions</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-3">
                                        <button class="btn btn-primary btn-block" onclick="createNewCard()">
                                            <i class="fa fa-plus"></i> Create New Card
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-info btn-block" onclick="viewAnalytics()">
                                            <i class="fa fa-chart-bar"></i> View Analytics
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-success btn-block" onclick="downloadQR()">
                                            <i class="fa fa-download"></i> Download QR Codes
                                        </button>
                                    </div>
                                    <div class="col-md-3">
                                        <button class="btn btn-warning btn-block" onclick="contactSupport()">
                                            <i class="fa fa-support"></i> Contact Support
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Partner Cards -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fa fa-credit-card"></i> My Cards</h5>
                            </div>
                            <div class="card-body">
                                <t t-if="partner_cards">
                                    <div class="table-responsive">
                                        <table class="table table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Category</th>
                                                    <th>Status</th>
                                                    <th>Views</th>
                                                    <th>Scans</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <t t-foreach="partner_cards" t-as="card">
                                                    <tr>
                                                        <td>
                                                            <strong><t t-esc="card.name"/></strong>
                                                            <br/>
                                                            <small class="text-muted">
                                                                <t t-esc="card.description[:50]"/>
                                                                <t t-if="len(card.description) > 50">...</t>
                                                            </small>
                                                        </td>
                                                        <td>
                                                            <span class="badge badge-info">
                                                                <t t-esc="card.category_id.name"/>
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <span t-att-class="'badge badge-' + ('success' if card.status == 'published' else 'warning' if card.status == 'pending' else 'secondary')">
                                                                <t t-esc="card.status.title()"/>
                                                            </span>
                                                        </td>
                                                        <td><t t-esc="card.views_count"/></td>
                                                        <td><t t-esc="card.scans_count"/></td>
                                                        <td>
                                                            <button class="btn btn-sm btn-outline-primary" onclick="editCard(<t t-esc="card.id"/>)">
                                                                <i class="fa fa-edit"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-info" onclick="viewCard(<t t-esc="card.id"/>)">
                                                                <i class="fa fa-eye"></i>
                                                            </button>
                                                            <button class="btn btn-sm btn-outline-success" onclick="downloadQR(<t t-esc="card.id"/>)">
                                                                <i class="fa fa-qrcode"></i>
                                                            </button>
                                                        </td>
                                                    </tr>
                                                </t>
                                            </tbody>
                                        </table>
                                    </div>
                                </t>
                                <t t-else="">
                                    <div class="text-center text-muted">
                                        <i class="fa fa-credit-card fa-3x mb-3"></i>
                                        <p>No cards created yet</p>
                                        <button class="btn btn-primary" onclick="createNewCard()">
                                            <i class="fa fa-plus"></i> Create Your First Card
                                        </button>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fa fa-history"></i> Recent Activity</h5>
                            </div>
                            <div class="card-body">
                                <t t-if="recent_activity">
                                    <div class="list-group">
                                        <t t-foreach="recent_activity" t-as="activity">
                                            <div class="list-group-item">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h6 class="mb-1"><t t-esc="activity.title"/></h6>
                                                    <small><t t-esc="activity.date"/></small>
                                                </div>
                                                <p class="mb-1"><t t-esc="activity.description"/></p>
                                            </div>
                                        </t>
                                    </div>
                                </t>
                                <t t-else="">
                                    <div class="text-center text-muted">
                                        <i class="fa fa-history fa-3x mb-3"></i>
                                        <p>No recent activity</p>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="row mt-4">
                    <div class="col-12 text-center">
                        <small class="text-muted">
                            <i class="fa fa-shield-alt"></i> 
                            Secured with SSO authentication
                        </small>
                    </div>
                </div>
            </div>
            
            <script>
                function createNewCard() {
                    // Redirect to card creation form
                    window.location.href = '/my/partner/create-card?sso=<t t-esc="sso_token"/>';
                }
                
                function viewAnalytics() {
                    // Redirect to analytics page
                    window.location.href = '/my/partner/analytics?sso=<t t-esc="sso_token"/>';
                }
                
                function downloadQR(cardId) {
                    // Download QR code for specific card
                    window.open('/my/partner/download-qr/' + cardId + '?sso=<t t-esc="sso_token"/>', '_blank');
                }
                
                function editCard(cardId) {
                    // Edit card
                    window.location.href = '/my/partner/edit-card/' + cardId + '?sso=<t t-esc="sso_token"/>';
                }
                
                function viewCard(cardId) {
                    // View card details
                    window.location.href = '/my/partner/view-card/' + cardId + '?sso=<t t-esc="sso_token"/>';
                }
                
                function contactSupport() {
                    // Open support chat
                    window.open('https://t.me/your_support_bot', '_blank');
                }
            </script>
        </t>
    </template>
    
</odoo>
