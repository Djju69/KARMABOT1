# 🌐 KarmaSystem WebApp

Полноценный личный кабинет для Telegram WebApp, дублирующий все функции бота.

## 🎯 **ФУНКЦИОНАЛ ПО РОЛЯМ**

### **👤 User (Пользователь)**
- 📊 Просмотр статистики
- 👤 Личный профиль
- 📈 История активности

### **🤝 Partner (Партнер)**
- Все функции User +
- 🏪 Управление карточками заведений
- ➕ Создание/редактирование карточек
- 📊 Статистика по карточкам

### **👥 Admin (Администратор)**
- Все функции Partner +
- 📋 Модерация партнерских карточек
- ✅ Одобрение/отклонение заявок
- 📊 Аналитика по системе

### **👑 Superadmin (Суперадмин)**
- Все функции Admin +
- ⚙️ Системные настройки
- 📊 Полная аналитика
- 🔧 Управление системой

## 🚀 **БЫСТРЫЙ СТАРТ**

### **1. Установка зависимостей**
```bash
cd webapp/backend
pip install -r requirements.txt
```

### **2. Настройка переменных окружения**
```bash
export BOT_TOKEN="your_bot_token"
export DATABASE_URL="postgresql://user:pass@localhost/db"
export JWT_SECRET="your_jwt_secret"
```

### **3. Запуск бэкенда**
```bash
cd webapp/backend
python main.py
```

### **4. Открытие WebApp**
- Откройте бота в Telegram
- Отправьте команду `/webapp`
- Нажмите кнопку "🌐 Открыть Личный кабинет"

## 🐳 **DOCKER ЗАПУСК**

```bash
cd webapp
docker-compose up -d
```

- Backend: http://localhost:8000
- Frontend: http://localhost:3000
- API Docs: http://localhost:8000/docs

## 📁 **СТРУКТУРА ПРОЕКТА**

```
webapp/
├── backend/
│   ├── main.py              # FastAPI приложение
│   ├── requirements.txt     # Python зависимости
│   └── Dockerfile          # Docker конфигурация
├── frontend/
│   ├── index.html          # HTML интерфейс
│   └── Dockerfile          # Nginx конфигурация
├── docker-compose.yml       # Docker Compose
└── README.md               # Документация
```

## 🔐 **БЕЗОПАСНОСТЬ**

- ✅ Валидация Telegram initData
- ✅ JWT токены с истечением
- ✅ RBAC по ролям (user/partner/admin/superadmin)
- ✅ Проверка прав на каждый эндпоинт
- ✅ CORS защита

## 📊 **API ЭНДПОИНТЫ**

### **Авторизация**
- `POST /api/auth/webapp` - Авторизация через initData

### **Пользователь**
- `GET /api/me` - Информация о пользователе
- `GET /api/stats/overview` - Общая статистика

### **Партнер**
- `GET /api/partner/cards` - Мои карточки
- `POST /api/partner/cards` - Создать карточку

### **Админ**
- `GET /api/admin/moderation` - Очередь модерации

## 🌐 **ИНТЕГРАЦИЯ С БОТОМ**

WebApp интегрируется с существующим ботом через команду `/webapp`:

1. Пользователь отправляет `/webapp`
2. Бот показывает кнопку "🌐 Открыть Личный кабинет"
3. WebApp открывается в браузере Telegram
4. Авторизация через Telegram initData
5. Полный доступ к функциям по роли

## 🔄 **СИНХРОНИЗАЦИЯ ДАННЫХ**

- WebApp использует ту же БД что и бот
- Все изменения синхронизируются в реальном времени
- Роли пользователей берутся из существующей таблицы `users`

## 🎨 **ТЕМЫ И ЛОКАЛИЗАЦИЯ**

- ✅ Поддержка тем Telegram (светлая/темная)
- ✅ Мультиязычность (RU/EN/VI/KO)
- ✅ Адаптивный дизайн
- ✅ Мобильный first

## 📈 **РАЗВИТИЕ**

### **Планируемые функции:**
- 📊 Расширенная аналитика
- 📧 Система уведомлений
- 🔄 Реальное время (WebSocket)
- 📱 PWA поддержка
- 🎨 Расширенные темы

### **Технические улучшения:**
- 🚀 Кэширование (Redis)
- 📊 Мониторинг
- 🔒 Расширенная безопасность
- 📈 Оптимизация производительности

## 🐛 **ОТЛАДКА**

### **Проверка авторизации:**
```bash
curl -X POST "http://localhost:8000/api/auth/webapp" \
  -H "Content-Type: application/json" \
  -d '{"init_data": "your_init_data"}'
```

### **Проверка API:**
```bash
curl -H "Authorization: Bearer your_token" \
  "http://localhost:8000/api/me"
```

## 📞 **ПОДДЕРЖКА**

При возникновении проблем:
1. Проверьте логи бэкенда
2. Убедитесь в правильности переменных окружения
3. Проверьте подключение к БД
4. Убедитесь что бот работает корректно

---

**WebApp полностью интегрирован с существующим ботом и использует те же роли и данные!** 🎉
