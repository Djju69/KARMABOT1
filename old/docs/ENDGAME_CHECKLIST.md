# Endgame Checklist (KARMABOT1)

Живой список финальных шагов перед релизом. Обновляем по мере продвижения.

## 1. Бот (Telegram)
- [ ] Политика: актуальный текст и ссылки в `core/utils/locales_v2.py`
- [ ] Версионирование политики: установить `POLICY_VERSION` на проде
- [ ] Мгновенная смена языка: финальная проверка всех кейсов
- [ ] Persistence: проверить Redis (policy, lang, city) после рестартов
- [ ] Команды и тексты: вычитка RU/EN/VI/KO
- [ ] MFA админов: включено и проверено (`web/routes_admin.py`)
- [ ] Политики доступа: централизованно через `core/security/policy.py`
- [ ] Логи/метрики: базовые события в `core/utils/metrics.py`/telemetry

## 2. Web-сервис (отдельный сервис Railway)
- [ ] Лэндинг + Кабинет (FastAPI+Jinja): каркас и базовые страницы
- [ ] Логин: Telegram Login Widget (или e-mail)
- [ ] Сессии: хранение в Redis, защита cookie
- [ ] Профиль: язык, статус политики, базовые настройки
- [ ] Кабинет партнёра: список карточек (MVP/заглушка)
- [ ] Админ: базовая страница статуса (доступ только админам)
- [ ] Деплой: `uvicorn web.main:app --host 0.0.0.0 --port $PORT`

## 3. Инфраструктура (Railway)
- [ ] Сервис бота: `python main_v2.py`
- [ ] Сервис web: `uvicorn web.main:app --host 0.0.0.0 --port $PORT`
- [ ] Переменные: `BOT_TOKEN`, `ADMIN_ID`, `REDIS_URL`, `ENVIRONMENT`, `LOG_LEVEL`, `POLICY_VERSION`
- [ ] Админ MFA env: `ADMIN_MFA_REQUIRED=1` (по умолчанию), `ADMIN_MFA_TOGGLE_ALLOWED=0|1`, `ADMIN_UI_2FA=0|1`
- [ ] Админ MFA runtime‑toggle (через Redis): проверить `GET /admin/mfa/status` и `POST /admin/mfa/toggle {"required": false|true}`
- [ ] Мониторинг логов, авто-ресдеплой по push

## 4. Безопасность и соответствие
- [ ] Секреты только в переменных окружения (не в git)
- [ ] Проверка `.gitignore` (`.env`, базы, приватные файлы)
- [ ] TLS для Redis при необходимости (`rediss://`)
- [ ] Минимизация логов с персональными данными

## 5. Контент и локализация
- [ ] Вычитка RU/EN/VI/KO ключевых строк
- [ ] Проверка клавиатур/иконок по языкам
- [ ] Актуализация ссылок (политика, поддержка)

## 6. Тест‑план перед продом
- [ ] Новый пользователь: язык → политика → главное меню
- [ ] Повторный запуск: нет повторной политики (до смены `POLICY_VERSION`)
- [ ] Смена языка: мгновенное обновление меню
- [ ] Город: выбор/сохранение
- [ ] Админ‑маршруты: доступ/запрет, MFA
- [ ] Нагрузочный smoke: быстрые команды, без падений

## 7. Релиз
- [ ] Установить финальные значения env в Railway
- [ ] Обновить `POLICY_VERSION` при необходимости
- [ ] Тег/релиз в GitHub, заметки релиза

---
Примечание: задачи по сайту‑визитке/кабинету начнём после готовности бота на 85–90%.
