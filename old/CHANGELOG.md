# CHANGELOG

## 2025-01-14 - i18n Housekeeping and Documentation Cleanup

### i18n Improvements
- **Fixed duplicate keys**: `back_to_main` ‚Üí `menu.back_to_main_menu`
- **Fixed duplicate keys**: `profile_settings` ‚Üí `keyboard.profile_settings`
- **Added 21 missing keys** to EN locale with proper translations
- **Created alias system** for backward compatibility
- **Implemented namespace structure**: `common.*`, `keyboard.*`, `menu.*`, `partner.*`, `admin.*`, `user.*`, `errors.*`, `messages.*`
- **Added deprecated.json** for old keys
- **Created i18n consistency tests** with automated validation
- **Updated locales_v2.py** with alias support

### Documentation Cleanup
- **Consolidated documentation**: Reduced from 49 to 4 main files
- **Created comprehensive guides**:
  - `docs/INSTALL.md` - Installation and deployment
  - `docs/USER_GUIDE.md` - User and partner guide
  - `docs/DEV_GUIDE.md` - Developer guide with Non-Breaking Dev Guide
  - `docs/i18n_guide.md` - Localization guide
  - `docs/i18n_namespaces.md` - Namespace structure
  - `docs/i18n_report.md` - Migration report
- **Removed duplicate files**: README2.md, TECHNICAL_SPECIFICATION.md, DEPLOY.md, DEPLOYMENT.md, DEPLOY_DOCS.md, TESTING.md, RAILWAY_VARS.md, TELEGRAM_SETUP.md
- **Maintained backward compatibility** for all existing functionality

### Technical Improvements
- **Enhanced get_text()** function with alias resolution
- **Added namespace-based key organization**
- **Implemented automated i18n testing**
- **Created migration report** with before/after analysis
- **Maintained all existing UI/UX** without breaking changes

## 2025-01-10 - Critical Fixes and AI Help Implementation

### Critical Fixes
1. **Fixed AI Help Handler**
   - Added explicit handler for "‚ùì –ü–æ–º–æ—â—å" button in all languages
   - Added callback handler for `help:main_menu` to return to main menu
   - Enhanced logging with [AI_HELP] prefix for better debugging

2. **Fixed Privacy Policy Middleware**
   - Added help commands to ALLOWED_COMMANDS list
   - Added `help:` callbacks to ALLOWED_CALLBACKS
   - Now allows `/help` and "‚ùì –ü–æ–º–æ—â—å" button without policy acceptance

3. **Fixed Database Issues**
   - Created `fix_database.sql` script to fix missing tables
   - Handles duplicate column errors gracefully
   - Creates missing tables: `cards_generated`, `favorites`, `karma_log`
   - Adds missing indexes for performance

4. **Fixed Pydantic Deprecation Warnings**
   - Replaced `orm_mode = True` with `from_attributes = True` in all schema files
   - Updated: models.py, auth.py, review.py, media.py, place.py, category.py, base.py

## 2025-01-10 - AI Help Implementation

### Added
- **Complete AI Help System** (`core/handlers/ai_help.py`)
  - Implemented full AI assistant functionality with menu system
  - Added interactive chat with FSM states (`AIHelpStates`)
  - Smart keyword-based responses for common questions (discounts, karma, registration, etc.)
  - FAQ section with structured Q&A format
  - Direct support contact integration
  - Multi-language support through i18n system

### Features
- **AI Chat Features**:
  - Context-aware responses based on keywords
  - Chat history tracking
  - "Ask another question" and "End chat" buttons
  - Graceful error handling
  - Rate limiting ready (stub implemented)

- **Help Menu Structure**:
  ```
  üÜò –¶–µ–Ω—Ç—Ä –ø–æ–º–æ—â–∏ Karma System
  [ü§ñ AI –ü–æ–º–æ—â–Ω–∏–∫] - –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
  [üìã FAQ] - –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã  
  [üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞] - —Å–≤—è–∑—å —Å –∫–æ–º–∞–Ω–¥–æ–π
  [‚óÄÔ∏è –ù–∞–∑–∞–¥] - –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
  ```

### Localization
- Added translations for all 4 languages (RU/EN/VI/KO):
  - `btn.ai_assistant`, `btn.faq`, `btn.contact_support`
  - `btn.ask_another`, `btn.end_chat`
  - `help.main_menu`, `ai.intro_message`
  - `ai.ask_question`, `ai.goodbye`, `main.menu_restored`

### Integration
- Integrated `ai_help_router` into `main_v2.py`
- Proper router ordering for priority handling
- Feature flag support (`settings.features.support_ai`)

### Technical Details
- Fallback responses for when OpenAI API is not available
- Keyword matching system for common topics
- Database integration for user language preferences
- Proper FSM state management for conversations

–î–∞—Ç–∞: 2025-08-24

## [Unreleased]

### [2025-09-09 16:50] –î–û–ë–ê–í–õ–ï–ù–ê –ö–ù–û–ü–ö–ê –°–ú–ï–ù–´ –Ø–ó–´–ö–ê –í–û –í–°–ï –ö–ê–ë–ò–ù–ï–¢–´

[2025-09-09 17:00] –ò–°–ü–†–ê–í–õ–ï–ù–´ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò –í –õ–ò–ß–ù–û–ú –ö–ê–ë–ò–ù–ï–¢–ï
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ - —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–æ {user_id}, {name}, {username}, {lang}
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ - —Ç–µ–ø–µ—Ä—å –∫—Ä–∞—Å–∏–≤—ã–π —Ç–µ–∫—Å—Ç —Å–æ —Å–∫—Ä—ã—Ç–æ–π —Å—Å—ã–ª–∫–æ–π –≤–º–µ—Å—Ç–æ –Ω–µ—á–∏—Ç–∞–µ–º–æ–≥–æ URL
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ referral_service - –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –ë–î fetch_all –Ω–∞ execute_query
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ /help –∫–∞–∫ inline –∫–Ω–æ–ø–∫–∞
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ –Ω–∞–ª–∏—á–∏–µ –∫–Ω–æ–ø–∫–∏ "–Ø–∑—ã–∫" –≤–æ –≤—Å–µ—Ö –∫–∞–±–∏–Ω–µ—Ç–∞—Ö (user/partner/admin/superadmin)

[2025-09-09 17:15] –ò–°–ü–†–ê–í–õ–ï–ù–´ –û–®–ò–ë–ö–ò –ò–ú–ü–û–†–¢–û–í –ò –û–ë–†–ê–ë–û–¢–ß–ò–ö–û–í
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç get_cancel_keyboard –≤ user.py - –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ get_return_to_main_menu
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ help –≤ cabinet_router.py - —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ referral_service - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ë–î
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ –∏–º–ø–æ—Ä—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–µ—à–∞–ª–∏ –∑–∞–ø—É—Å–∫—É –±–æ—Ç–∞

[2025-09-09 17:30] –ò–°–ü–†–ê–í–õ–ï–ù AI –ê–°–°–ò–°–¢–ï–ù–¢ –ò –ö–ù–û–ü–ö–ê –Ø–ó–´–ö–ê
- –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ help –∏–∑ cabinet_router.py - —Ç–µ–ø–µ—Ä—å AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ help_with_ai_router
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —è–∑—ã–∫–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–ª—è—Ç—å—Å—è –≤ /help –∫–∞–∫ inline –∫–Ω–æ–ø–∫–∞ "ü§ñ –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ò–ò"

[2025-09-09 17:45] –î–û–ë–ê–í–õ–ï–ù–ê –°–ò–°–¢–ï–ú–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø–ú–ò –í AI-–ê–°–°–ò–°–¢–ï–ù–¢–ê
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ —Å–æ–≥–ª–∞—Å–Ω–æ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –ø—Ä–æ–º—Ç—É AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ "–ö–∞—Ä–º–∞"
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –ø–∞—Ä—Ç–Ω–µ—Ä, –∞–¥–º–∏–Ω, —Å—É–ø–µ—Ä–∞–¥–º–∏–Ω)
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (LOW, NORMAL, HIGH, CRITICAL)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ /notifications –∏ –∫–Ω–æ–ø–∫–∞ "‚öôÔ∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏" –≤–æ –≤—Å–µ –∫–∞–±–∏–Ω–µ—Ç—ã
- AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ç–µ–ø–µ—Ä—å —É–º–µ–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏—Ö–∏—Ö —á–∞—Å–æ–≤ –∏ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

[2025-09-09 18:00] –ò–°–ü–†–ê–í–õ–ï–ù–´ –ù–ê–°–¢–†–û–ô–ö–ò –ò AI –ê–°–°–ò–°–¢–ï–ù–¢
- –°–æ–∑–¥–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏" –≤–æ –≤—Å–µ—Ö –∫–∞–±–∏–Ω–µ—Ç–∞—Ö –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ "üåê –Ø–∑—ã–∫" –∏ "üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" –≤ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ - –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ —Ç–æ–ª—å–∫–æ "üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è" –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç - –¥–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "‚ùì –ü–æ–º–æ—â—å"
- –°–æ–∑–¥–∞–Ω settings_router –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –£–ø—Ä–æ—â–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞–±–∏–Ω–µ—Ç–æ–≤ - —É–±—Ä–∞–Ω—ã –ª–∏—à–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
- help_with_ai_router –ø–æ–¥–∫–ª—é—á–µ–Ω –ü–ï–†–í–´–ú –¥–ª—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø–µ—Ä–µ—Ö–≤–∞—Ç–∞ /help
- –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∫–ª—é—á–∏ –ø–µ—Ä–µ–≤–æ–¥–æ–≤ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (btn.notify.on/off)
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
- –ö–Ω–æ–ø–∫–∞ "üåê –Ø–∑—ã–∫" –¥–æ–ª–∂–Ω–∞ —Ä–∞–±–æ—Ç–∞—Ç—å –≤–æ –≤—Å–µ—Ö –∫–∞–±–∏–Ω–µ—Ç–∞—Ö

#### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–ö–Ω–æ–ø–∫–∞ "üåê –Ø–∑—ã–∫"** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤–æ –≤—Å–µ –ª–∏—á–Ω—ã–µ –∫–∞–±–∏–Ω–µ—Ç—ã (user/partner/admin/superadmin)
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —è–∑—ã–∫–∞** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ partner.py –∏ admin_cabinet.py
- **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å** - –∫–Ω–æ–ø–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç RU/EN/VI/KO

### [2025-09-09 16:45] –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø AI-–ê–°–°–ò–°–¢–ï–ù–¢–ê –ò –ú–ò–ì–†–ê–¶–ò–ô

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **Feature flags AI** - –≤–∫–ª—é—á–µ–Ω—ã `FEATURE_SUPPORT_AI=True` –∏ `FEATURE_SUPPORT_REPORTS=True`
- **–ú–∏–≥—Ä–∞—Ü–∏—è 010** - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ —Å–ø–∏—Å–æ–∫ –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü favorites, referrals, karma_log, points_log, achievements
- **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ "relation cards_generated does not exist"

### [2025-09-09 16:30] –í–û–°–°–¢–ê–ù–û–í–õ–ï–ù–ò–ï AI-–ê–°–°–ò–°–¢–ï–ù–¢–ê "–ö–ê–†–ú–ê"

#### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- **AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç "–ö–∞—Ä–º–∞"** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- **FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è** - `SupportStates` –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è AI-—á–∞—Ç–æ–º
- **–°–µ—Ä–≤–∏—Å—ã –ø–æ–¥–¥–µ—Ä–∂–∫–∏** - `SupportAIService`, `ReportService`, `STTService`
- **Email –æ—Ç–ø—Ä–∞–≤–∫–∞** - `EmailSender` –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤
- **Rate limiting** - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã AI** - –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ AI-—Ä–µ–∂–∏–º–µ
- **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏** - `help_with_ai.py`, `support_ai.py`
- **i18n –∫–ª—é—á–∏** - –ø–æ–ª–Ω–∞—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
- **Feature flags** - `FEATURE_SUPPORT_AI`, `FEATURE_SUPPORT_REPORTS`, `FEATURE_SUPPORT_VOICE`
- **–°–∫—Ä—ã—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞** - `/support` –¥–ª—è –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ AI
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤ –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –±–æ—Ç—É

#### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞
- **–ö–Ω–æ–ø–∫–∞ –ø–æ–¥ /help** - "ü§ñ –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å –ò–ò" –¥–ª—è –≤—Å–µ—Ö —Ä–æ–ª–µ–π
- **–†–æ–ª–µ–≤—ã–µ –æ—Ç—á—ë—Ç—ã** - —Ä–∞–∑–Ω—ã–µ –æ—Ç—á—ë—Ç—ã –¥–ª—è user/partner/admin/superadmin
- **–ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è** - —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä–µ—á–∏ (–¥–æ 60 —Å–µ–∫, 2 –ú–ë)
- **FAQ —Å–∏—Å—Ç–µ–º–∞** - –æ—Ç–≤–µ—Ç—ã –Ω–∞ —á–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
- **–≠—Å–∫–∞–ª–∞—Ü–∏—è** - –ø–µ—Ä–µ–¥–∞—á–∞ —Å–ª–æ–∂–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É
- **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ RU/EN/VI/KO

### [2025-09-09 16:00] –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

#### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- **–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ (no such column: qr_id)
- **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã fetch_one/fetch_all ‚Üí execute_query
- **–°–µ—Ä–≤–∏—Å –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –ë–î –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- **–ò–º–ø–æ—Ä—Ç—ã**: —É–¥–∞–ª–µ–Ω –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π get_confirmation_keyboard –∏–∑ user.py
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç settings –≤ main_menu_router.py
- **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏**: –æ—Ç–∫–ª—é—á–µ–Ω –ø–æ–∫–∞–∑ —Å–ø–∏—Å–∫–∞ —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –º–µ—Å—Ç (—Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∏)
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∫–æ–Ω–æ–∫**: —É–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–º–æ–¥–∑–∏ –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö
- **–ö–æ–º–∞–Ω–¥–∞ /add**: —É–ø—Ä–æ—â–µ–Ω–∞, –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∫ –∫–Ω–æ–ø–∫–µ –≤ –º–µ–Ω—é
- **–¢–µ–∫—Å—Ç –ø–æ–º–æ—â–∏**: –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –∫—Ä–∞—Å–∏–≤—ã–π HTML —Ñ–æ—Ä–º–∞—Ç —Å —Å–µ–∫—Ü–∏—è–º–∏
- **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞**: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å HTML —Ç–µ–≥–∞–º–∏

#### –ò–∑–º–µ–Ω–µ–Ω–æ
- **–ü–æ–∫–∞–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–π**: —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∏ –±–µ–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–º–æ—â–∏**: HTML –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
- **–ü–∞—Ä—Å–∏–Ω–≥ —Å–æ–æ–±—â–µ–Ω–∏–π**: Markdown ‚Üí HTML –¥–ª—è —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤

### –î–æ–±–∞–≤–ª–µ–Ω–æ
- **–û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫**:
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Pydantic v2 —Å –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å—é
  - –ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ñ–∏—á–∞-—Ñ–ª–∞–≥–æ–≤ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º
  - –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
  - –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã
- **QR-–∫–æ–¥—ã**:
  - –°–µ—Ä–≤–∏—Å –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è QR-–∫–æ–¥–∞–º–∏
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WebApp –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
  - –ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å QR-–∫–æ–¥–∞–º–∏
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**:
  - –û–±–Ω–æ–≤–ª–µ–Ω README —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å QR-–∫–æ–¥–∞–º–∏

### –ò–∑–º–µ–Ω–µ–Ω–æ
- –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫ –¥–ª—è –±–æ–ª—å—à–µ–π –≥–∏–±–∫–æ—Å—Ç–∏
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ requirements.txt
- **Loyalty System**:
  - –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ `loyalty_points_tx` –¥–ª—è —É—á–µ—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å –±–∞–ª–ª–∞–º–∏
  - –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `LoyaltyService` —Å –º–µ—Ç–æ–¥–∞–º–∏:
    - `add_transaction()`: –ó–∞–ø–∏—Å—å –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è/—Å–ø–∏—Å–∞–Ω–∏—è –±–∞–ª–ª–æ–≤
    - `get_balance()`: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞ (—Å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º)
    - `get_recent_transactions()`: –ü—Ä–æ—Å–º–æ—Ç—Ä –∏—Å—Ç–æ—Ä–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–º –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –±–∞–ª–ª–æ–≤ –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
  - –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- SPA-—Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞–±–∏–Ω–µ—Ç–∞ (`INDEX_HTML` –≤ `web/main.py`) —Å –≤–∫–ª–∞–¥–∫–∞–º–∏ ¬´–ü—Ä–æ—Ñ–∏–ª—å¬ª –∏ ¬´–ú–æ–∏ –∫–∞—Ä—Ç–æ—á–∫–∏¬ª.
- –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã UI: `#status`, `#error`, `#diag`, —Å—Ç–∞—Ç—É—Å—ã –ø—Ä–∏ –≤–≤–æ–¥–µ —Ç–æ–∫–µ–Ω–∞.
- –ê–≤—Ç–æ–±—É—Ç—Å—Ç—Ä–∞–ø SQLite (`web/routes_cabinet.py`): —Å–æ–∑–¥–∞—é—Ç—Å—è –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã `partners_v2`, `categories_v2`, `cards_v2` –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ.
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
  - `README_WEBAPP.md` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞, –∫–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å/—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å.
  - `TZ_LK.md` ‚Äî —Å–≤–æ–¥–Ω–æ–µ –¢–ó –ø–æ –ª–∏—á–Ω—ã–º –∫–∞–±–∏–Ω–µ—Ç–∞–º.

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
- –§—Ä–æ–Ω—Ç–µ–Ω–¥ `asciiToken()` —Ç–µ–ø–µ—Ä—å —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –¥–æ –ø–µ—á–∞—Ç–∞–µ–º—ã—Ö ASCII (32..126) ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫ Authorization.
- `devTokenFlow()` —Å—Ä–∞–∑—É –≤—ã–∑—ã–≤–∞–µ—Ç `loadProfile()` (UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –¥–∞–∂–µ –±–µ–∑ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞), –ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º—è–≥–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ URL —Å `?token=`.
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –≤ –ø–æ–ª–µ —Ç–æ–∫–µ–Ω–∞ –∏ —è–≤–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã ¬´–ü—Ä–∏–º–µ–Ω—è—é —Ç–æ–∫–µ–Ω‚Ä¶ / –ó–∞–≥—Ä—É–∂–∞—é –ø—Ä–æ—Ñ–∏–ª—å‚Ä¶¬ª.

### –ò–∑–º–µ–Ω–µ–Ω–æ
- `web/routes_cabinet.py`: —É—Å–∏–ª–µ–Ω–∞ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å `get_current_claims()` –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ auth-—Å–æ–±—ã—Ç–∏–π.
- –í–æ–∑–≤—Ä–∞—Ç –ø—É—Å—Ç—ã—Ö —Å–ø–∏—Å–∫–æ–≤ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∫–æ–¥–æ–≤ –≤–º–µ—Å—Ç–æ 500 –ø—Ä–∏ –ø—É—Å—Ç–æ–π –ë–î.

### –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π UI –∫–∞—Ä—Ç–æ—á–µ–∫ (—Ñ–∏–ª—å—Ç—Ä—ã/—Ç–∞–±–ª–∏—Ü–∞/–º–æ–¥–∞–ª–∫–∏/–ø–∞–≥–∏–Ω–∞—Ü–∏—è) ‚Äî –Ω–µ –∑–∞–≤–µ—Ä—à—ë–Ω (MVP-—Ä–µ–Ω–¥–µ—Ä –≤ `ul#cardsList`).
- –í–æ–∑–º–æ–∂–Ω—ã 401/403 –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º/–ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–º —Ç–æ–∫–µ–Ω–µ.
- –í –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Å–±—Ä–æ—Å –∫—ç—à–∞/Service Worker (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Ctrl+F5/–∏–Ω–∫–æ–≥–Ω–∏—Ç–æ).
