# CHANGELOG

Дата: 2025-08-24

## [Unreleased] — WebApp freeze snapshot

### Добавлено
- SPA-страница кабинета (`INDEX_HTML` в `web/main.py`) с вкладками «Профиль» и «Мои карточки».
- Диагностические элементы UI: `#status`, `#error`, `#diag`, статусы при вводе токена.
- Автобутстрап SQLite (`web/routes_cabinet.py`): создаются минимальные таблицы `partners_v2`, `categories_v2`, `cards_v2` при первом запуске.
- Документация:
  - `README_WEBAPP.md` — состояние проекта, как запускать/тестировать.
  - `TZ_LK.md` — сводное ТЗ по личным кабинетам.

### Исправлено
- Фронтенд `asciiToken()` теперь фильтрует токен до печатаемых ASCII (32..126) — безопасный заголовок Authorization.
- `devTokenFlow()` сразу вызывает `loadProfile()` (UI обновляется даже без редиректа), после этого мягкий переход на URL с `?token=`.
- Обработчик Enter в поле токена и явные статусы «Применяю токен… / Загружаю профиль…».

### Изменено
- `web/routes_cabinet.py`: усилена устойчивость `get_current_claims()` и логирование auth-событий.
- Возврат пустых списков и корректных кодов вместо 500 при пустой БД.

### Известные ограничения
- Продвинутый UI карточек (фильтры/таблица/модалки/пагинация) — не завершён (MVP-рендер в `ul#cardsList`).
- Возможны 401/403 при невалидном/просроченном токене.
- В отдельных окружениях требуется принудительный сброс кэша/Service Worker (используйте Ctrl+F5/инкогнито).
