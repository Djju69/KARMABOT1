# KarmaSystemBot - Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ

## ðŸ§ª Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

### Ð—Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð² Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾

1. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸:
```bash
pip install -r requirements.txt
pip install pytest pytest-cov pytest-asyncio
```

2. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²ÑƒÑŽ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… PostgreSQL

3. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ñ‚ÐµÑÑ‚Ñ‹:
```bash
DATABASE_URL=postgresql://user:password@localhost:5432/test_db TESTING=1 pytest tests/ -v
```

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ‚ÐµÑÑ‚Ð¾Ð²

- `tests/integration/` - Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¾Ð½Ð½Ñ‹Ðµ Ñ‚ÐµÑÑ‚Ñ‹
  - `test_admin_*.py` - Ñ‚ÐµÑÑ‚Ñ‹ Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»Ð¸
  - `test_handlers.py` - Ñ‚ÐµÑÑ‚Ñ‹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð²
- `tests/unit/` - ÑŽÐ½Ð¸Ñ‚-Ñ‚ÐµÑÑ‚Ñ‹

### Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚ÐµÑÑ‚Ð¾Ð²

1. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ ÐºÐ»Ð°ÑÑ, ÑƒÐ½Ð°ÑÐ»ÐµÐ´Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¾Ñ‚ `BaseBotTest`
2. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ `AsyncMock` Ð´Ð»Ñ Ð¼Ð¾ÐºÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ñ… Ð²Ñ‹Ð·Ð¾Ð²Ð¾Ð²
3. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ ÐºÐ°Ðº ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ðµ ÑÑ†ÐµÐ½Ð°Ñ€Ð¸Ð¸, Ñ‚Ð°Ðº Ð¸ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð¾ÑˆÐ¸Ð±Ð¾Ðº

## ðŸš€ Ð”ÐµÐ¿Ð»Ð¾Ð¹

### ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ

Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ„Ð°Ð¹Ð» `.env` ÑÐ¾ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ð¼Ð¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼Ð¸:

```env
DATABASE_URL=postgresql://user:password@host:port/dbname
BOT_TOKEN=your_telegram_bot_token
ADMIN_IDS=12345,67890
```

### Staging

1. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ…
2. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸:
```bash
python -m alembic upgrade head
```
3. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð±Ð¾Ñ‚Ð°:
```bash
python main_v2.py
```

### Production

1. Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ‚ÐµÐ³ Ñ€ÐµÐ»Ð¸Ð·Ð°:
```bash
git tag -a v1.0.0 -m "Production release"
git push origin v1.0.0
```

2. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð´ÐµÐ¿Ð»Ð¾Ð¹ (Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ð´Ð»Ñ Railway):
```bash
railway up --service bot
```

## ðŸ”§ Troubleshooting

### Ð§Ð°ÑÑ‚Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹

1. **ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ð‘Ð”**
   - ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑ‚Ñ€Ð¾ÐºÑƒ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
   - Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð‘Ð” Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°

2. **ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ Ð¿Ñ€Ð°Ð²Ð°Ð¼Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð°**
   - ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ `ADMIN_IDS`
   - Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð² Ð°Ð´Ð¼Ð¸Ð½Ñ‹

### Ð›Ð¾Ð³Ð¸

Ð›Ð¾Ð³Ð¸ Ñ…Ñ€Ð°Ð½ÑÑ‚ÑÑ Ð² `logs/bot.log`

### ÐžÑ‚ÐºÐ°Ñ‚

1. ÐžÑ‚ÐºÐ°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ðº Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¼Ñƒ Ñ‚ÐµÐ³Ñƒ:
```bash
git checkout v0.9.0
```
2. ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐµÑ€Ð²Ð¸Ñ

## ðŸ“Š ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³

### ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸

- Ð”Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾ÑÑ‚ÑŒ ÑÐµÑ€Ð²Ð¸ÑÐ°
- Ð’Ñ€ÐµÐ¼Ñ Ð¾Ñ‚Ð²ÐµÑ‚Ð°
- ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²

### Alerting

- ÐžÑˆÐ¸Ð±ÐºÐ¸ 5xx
- Response time > 1000ms
- Memory usage > 80%
