<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- KarmaBot User Tree View -->
    <record id="view_karmabot_user_tree" model="ir.ui.view">
        <field name="name">karmabot.user.tree</field>
        <field name="model">karmabot.user</field>
        <field name="arch" type="xml">
            <tree string="KarmaBot Users" decoration-info="not is_active" decoration-muted="not is_verified">
                <field name="name"/>
                <field name="telegram_username"/>
                <field name="role"/>
                <field name="total_points"/>
                <field name="available_points"/>
                <field name="total_scans"/>
                <field name="registration_date"/>
                <field name="last_activity"/>
                <field name="is_active"/>
                <field name="is_verified"/>
            </tree>
        </field>
    </record>
    
    <!-- KarmaBot User Form View -->
    <record id="view_karmabot_user_form" model="ir.ui.view">
        <field name="name">karmabot.user.form</field>
        <field name="model">karmabot.user</field>
        <field name="arch" type="xml">
            <form string="KarmaBot User">
                <header>
                    <button name="action_add_points" string="Add Points" type="object" class="btn-primary" groups="karmabot.group_karmabot_admin"/>
                    <button name="action_spend_points" string="Spend Points" type="object" class="btn-secondary" groups="karmabot.group_karmabot_admin"/>
                    <button name="action_verify_user" string="Verify" type="object" class="btn-success" groups="karmabot.group_karmabot_admin" attrs="{'invisible': [('is_verified', '=', True)]}"/>
                    <button name="action_deactivate_user" string="Deactivate" type="object" class="btn-warning" groups="karmabot.group_karmabot_admin" attrs="{'invisible': [('is_active', '=', False)]}"/>
                    <button name="action_activate_user" string="Activate" type="object" class="btn-success" groups="karmabot.group_karmabot_admin" attrs="{'invisible': [('is_active', '=', True)]}"/>
                    <field name="is_active" widget="statusbar" statusbar_visible="active"/>
                </header>
                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_cards" type="object" class="oe_stat_button" icon="fa-credit-card">
                            <field name="linked_cards_count" widget="statinfo" string="Cards"/>
                        </button>
                        <button name="action_view_transactions" type="object" class="oe_stat_button" icon="fa-list">
                            <field name="transactions_count" widget="statinfo" string="Transactions"/>
                        </button>
                    </div>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="User Name"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="telegram_id"/>
                            <field name="telegram_username"/>
                            <field name="telegram_first_name"/>
                            <field name="telegram_last_name"/>
                            <field name="role"/>
                            <field name="referral_code"/>
                        </group>
                        <group>
                            <field name="total_points"/>
                            <field name="available_points"/>
                            <field name="pending_points"/>
                            <field name="spent_points"/>
                            <field name="total_scans"/>
                            <field name="total_referrals"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="registration_date"/>
                            <field name="last_activity"/>
                            <field name="language"/>
                            <field name="notifications_enabled"/>
                        </group>
                        <group>
                            <field name="referred_by"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Linked Cards" name="cards">
                            <field name="linked_cards">
                                <tree>
                                    <field name="card_number"/>
                                    <field name="card_type"/>
                                    <field name="is_active"/>
                                    <field name="linked_date"/>
                                    <field name="last_used"/>
                                    <field name="usage_count"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Transactions" name="transactions">
                            <field name="transactions">
                                <tree>
                                    <field name="transaction_type"/>
                                    <field name="points"/>
                                    <field name="description"/>
                                    <field name="status"/>
                                    <field name="transaction_date"/>
                                    <field name="fraud_check_passed"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Referrals" name="referrals">
                            <field name="referrals">
                                <tree>
                                    <field name="name"/>
                                    <field name="telegram_username"/>
                                    <field name="registration_date"/>
                                    <field name="total_points"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- KarmaBot User Search View -->
    <record id="view_karmabot_user_search" model="ir.ui.view">
        <field name="name">karmabot.user.search</field>
        <field name="model">karmabot.user</field>
        <field name="arch" type="xml">
            <search string="Search KarmaBot Users">
                <field name="name"/>
                <field name="telegram_username"/>
                <field name="telegram_id"/>
                <field name="referral_code"/>
                <separator/>
                <filter string="Active Users" name="active" domain="[('is_active', '=', True)]"/>
                <filter string="Verified Users" name="verified" domain="[('is_verified', '=', True)]"/>
                <filter string="Partners" name="partners" domain="[('role', '=', 'partner')]"/>
                <filter string="Admins" name="admins" domain="[('role', 'in', ['admin', 'super_admin'])]"/>
                <separator/>
                <filter string="High Points" name="high_points" domain="[('total_points', '>=', 1000)]"/>
                <filter string="Recent Activity" name="recent" domain="[('last_activity', '>=', (context_today() - datetime.timedelta(days=7)).strftime('%Y-%m-%d'))]"/>
                <group expand="0" string="Group By">
                    <filter string="Role" name="group_role" context="{'group_by': 'role'}"/>
                    <filter string="Registration Date" name="group_registration" context="{'group_by': 'registration_date:month'}"/>
                    <filter string="Last Activity" name="group_activity" context="{'group_by': 'last_activity:month'}"/>
                </group>
            </search>
        </field>
    </record>
    
    <!-- KarmaBot User Action -->
    <record id="action_karmabot_user" model="ir.actions.act_window">
        <field name="name">KarmaBot Users</field>
        <field name="res_model">karmabot.user</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="view_karmabot_user_search"/>
        <field name="context">{'search_default_active': 1}</field>
    </record>
    
    <!-- KarmaBot User Card Tree View -->
    <record id="view_karmabot_user_card_tree" model="ir.ui.view">
        <field name="name">karmabot.user.card.tree</field>
        <field name="model">karmabot.user.card</field>
        <field name="arch" type="xml">
            <tree string="User Cards">
                <field name="user_id"/>
                <field name="card_number"/>
                <field name="card_type"/>
                <field name="is_active"/>
                <field name="linked_date"/>
                <field name="last_used"/>
                <field name="usage_count"/>
            </tree>
        </field>
    </record>
    
    <!-- KarmaBot User Card Form View -->
    <record id="view_karmabot_user_card_form" model="ir.ui.view">
        <field name="name">karmabot.user.card.form</field>
        <field name="model">karmabot.user.card</field>
        <field name="arch" type="xml">
            <form string="User Card">
                <sheet>
                    <group>
                        <group>
                            <field name="user_id"/>
                            <field name="card_number"/>
                            <field name="card_type"/>
                            <field name="is_active"/>
                        </group>
                        <group>
                            <field name="linked_date"/>
                            <field name="last_used"/>
                            <field name="usage_count"/>
                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>
    
    <!-- KarmaBot User Card Action -->
    <record id="action_karmabot_user_card" model="ir.actions.act_window">
        <field name="name">User Cards</field>
        <field name="res_model">karmabot.user.card</field>
        <field name="view_mode">tree,form</field>
    </record>
    
</odoo>
