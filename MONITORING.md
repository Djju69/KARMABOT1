# üìä –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ KarmaBot

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
# .env
SENTRY_DSN=https://your_actual_dsn.ingest.sentry.io/your_project
ENVIRONMENT=production
APP_VERSION=1.0.0
LOG_LEVEL=INFO
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
pip install -r requirements.txt
```

3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash
uvicorn web.main:app --host 0.0.0.0 --port 8080
```

## üìã –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### Health Check
```
GET /api/health
```
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –¢–µ—Å—Ç–æ–≤—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
```
GET /api/test/error      # –¢–µ—Å—Ç –æ—à–∏–±–æ–∫
GET /api/test/metrics    # –¢–µ—Å—Ç –º–µ—Ç—Ä–∏–∫
GET /api/test/logs       # –¢–µ—Å—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Sentry
1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –≤ [Sentry.io](https://sentry.io)
2. –ü–æ–ª—É—á–∏—Ç–µ DSN –∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø—Ä–æ–µ–∫—Ç–∞
3. –î–æ–±–∞–≤—å—Ç–µ DSN –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

## üìä –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- `bot.messages_processed` - –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- `bot.errors_total` - –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
- `response_time_ms` - –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
- `database.query_duration` - –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î

## üö® –ê–ª–∞—Ä—Ç—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ Sentry Dashboard:
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ ‚Üí Slack/Email
- –ü—Ä–æ–±–ª–µ–º—ã —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é ‚Üí Slack
- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–∞ ‚Üí PagerDuty

## üê≥ Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t karmabot .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -d --name karmabot \
  -p 8080:8080 \
  --env-file .env \
  karmabot
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ health check:
```bash
curl http://localhost:8080/api/health
```

2. –¢–µ—Å—Ç –æ—à–∏–±–æ–∫ (–¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ Sentry):
```bash
curl http://localhost:8080/api/test/error
```

3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫:
```bash
curl http://localhost:8080/api/test/metrics
```

## üõ†Ô∏è –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

1. **–û—à–∏–±–∫–∏ Sentry**
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DSN –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

2. **–ü—Ä–æ–±–ª–µ–º—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Sentry SDK –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∏–º–µ–Ω –º–µ—Ç—Ä–∏–∫
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—ç–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏—è

## üìà –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—ç–º–ø–ª–∏–Ω–≥–∞**
   ```python
   # –í core/config/monitoring.py
   class SentrySettings:
       traces_sample_rate = 0.2  # 20% —Ç—Ä–∞—Ñ–∏–∫–∞
       profiles_sample_rate = 0.1  # 10% –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–π
   ```

2. **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π**
   ```python
   # –í core/monitoring.py
   def before_send(event, hint):
       if 'exc_info' in hint:
           exc_type, exc_value, tb = hint['exc_info']
           if isinstance(exc_value, SomeExpectedException):
               return None  # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ–∂–∏–¥–∞–µ–º—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
       return event
   ```
