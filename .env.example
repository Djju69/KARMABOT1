# KARMABOT1 - Environment Configuration Template
# Copy this file to .env and fill in your actual values

# Bot Configuration
BOT_TOKEN=your_bot_token_here
ADMIN_ID=your_admin_id_here

# Database - Railway PostgreSQL
DATABASE_URL=postgresql+asyncpg://karma:karma@localhost:5432/karma

# Feature Flags (default: false for safety)
FEATURE_PARTNER_FSM=false
FEATURE_MODERATION=false
FEATURE_NEW_MENU=false
FEATURE_QR_WEBAPP=false
FEATURE_LISTEN_NOTIFY=false

# Google Service Account (optional)
GOOGLE_SERVICE_ACCOUNT_PATH=

# Logging
LOG_LEVEL=INFO
ENVIRONMENT=production
POLICY_VERSION=1

# Security
FERNET_KEY_HEX=your_32_byte_hex_key_here
# JWT секрет для WebApp API (если пусто, будет dev-подпись "debug")
JWT_SECRET=your_jwt_secret_here
# Сколько секунд действителен initData (анти-replay окно)
AUTH_WINDOW_SEC=300

# Admin migration guards (dev-only; disable in prod)
ALLOW_ADMIN_MIGRATIONS=0
ADMIN_SQL_TOKEN=

# Admin MFA control
# If not set, MFA is required by default (secure-by-default)
ADMIN_MFA_REQUIRED=1
# Allow runtime toggle via /admin/mfa/toggle
ADMIN_MFA_TOGGLE_ALLOWED=0
# Serve simple HTML page at /admin/2fa/ui
ADMIN_UI_2FA=0

# Redis - Railway Redis
REDIS_URL=redis://localhost:6379/0

# WebApp (FastAPI)
# URL, на который указывает кнопка /webapp (точка входа вашего фронта)
WEBAPP_QR_URL=http://127.0.0.1:8000
# Разрешённый origin фронтенда для CORS
WEBAPP_ALLOWED_ORIGIN=http://localhost:3000
# Разрешённый origin для CSP connect-src и др.
CSP_ALLOWED_ORIGIN=http://localhost:3000

# Dev: запуск только FastAPI без обязательных BOT_TOKEN/ADMIN_ID
FASTAPI_ONLY=0

# Railway specific
PORT=8000
RAILWAY_ENVIRONMENT=production

# AuthMe cache
AUTHME_CACHE_TTL_SEC=8
AUTHME_CACHE_SOFT_TTL_SEC=4

# Webhook security for /bot/hooks/ui.refresh_menu
BOT_WEBHOOK_SECRET=change_me
BOT_WEBHOOK_MAX_SKEW_SEC=120
# Comma-separated IPs/CIDRs, e.g.: 1.2.3.4,10.0.0.0/8
WEBHOOK_IP_ALLOWLIST=

# SESSION_STATE persistence
SESSION_STATE_PATH=ops/SESSION_STATE.json
SESSION_STATE_SCHEMA_PATH=ops/SESSION_STATE.schema.json
SESSION_STATE_ROTATE_N=5
APP_VERSION=v2.4.2
NODE_ID=api-1

# Monitoring (optional)
PROMETHEUS_PUSHGATEWAY_URL=
