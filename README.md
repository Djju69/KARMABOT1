# KARMABOT1 - Enhanced Telegram Bot

–°–∏—Å—Ç–µ–º–∞ —Å–∫–∏–¥–æ–∫ –∏ –∫–∞—Ç–∞–ª–æ–≥–∞ –∑–∞–≤–µ–¥–µ–Ω–∏–π –¥–ª—è Telegram —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏.

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
git clone <repository-url>
cd KARMABOT1-fixed
pip install -r requirements.txt
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
cp .env.example .env

# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª
nano .env
```

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```env
BOT_TOKEN=your_bot_token_from_botfather
ADMIN_ID=your_telegram_user_id
```

### 3. –ó–∞–ø—É—Å–∫

```bash
# –û—Å–Ω–æ–≤–Ω–æ–π —Å–ø–æ—Å–æ–±
python main_v2.py

# –ò–ª–∏ legacy –≤–µ—Ä—Å–∏—è (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)
python main.py
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
BOT_TOKEN=1234567890:ABC...                 # –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç BotFather
ADMIN_ID=123456789                          # Telegram ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
DATABASE_URL=sqlite:///core/database/data.db # –ü—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

# –§–∏—á–∞-—Ñ–ª–∞–≥–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
FEATURE_PARTNER_FSM=false                   # FSM –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫ –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏
FEATURE_MODERATION=false                    # –°–∏—Å—Ç–µ–º–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
FEATURE_NEW_MENU=false                      # –ù–æ–≤–æ–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é (3x2)
FEATURE_QR_WEBAPP=false                     # QR WebApp —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
FEATURE_LISTEN_NOTIFY=false                 # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ PUB/SUB

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
LOG_LEVEL=INFO                              # –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
ENVIRONMENT=development                     # –û–∫—Ä—É–∂–µ–Ω–∏–µ (development/production)
```

### –ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

**–§–∞–∑–∞ 1 - –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
```env
# –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)
FEATURE_PARTNER_FSM=false
FEATURE_MODERATION=false
FEATURE_NEW_MENU=false
```

**–§–∞–∑–∞ 2 - –ü–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
```env
# –í–∫–ª—é—á–∞–µ–º FSM –¥–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
FEATURE_PARTNER_FSM=true
FEATURE_MODERATION=true
FEATURE_NEW_MENU=false
```

**–§–∞–∑–∞ 3 - –ü–æ–ª–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
```env
# –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤–∫–ª—é—á–µ–Ω—ã
FEATURE_PARTNER_FSM=true
FEATURE_MODERATION=true
FEATURE_NEW_MENU=true
```

## üìã –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üóÇÔ∏è **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏** - –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–≤–µ–¥–µ–Ω–∏–π –ø–æ —Ç–∏–ø–∞–º
- üìç **–ü–æ–∏—Å–∫ —Ä—è–¥–æ–º** - –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫
- üåÜ **–ü–æ —Ä–∞–π–æ–Ω–∞–º** - –≤—ã–±–æ—Ä –ø–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—é
- üåê **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å** - RU/EN/VI/KO
- üì± **QR-–∫–æ–¥—ã** - –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–∫–∏–¥–æ–∫

### –î–ª—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ (–ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º FEATURE_PARTNER_FSM)
- ‚ûï **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–µ–∫** - –ø–æ—à–∞–≥–æ–≤—ã–π FSM –ø—Ä–æ—Ü–µ—Å—Å
- üìã **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏** - –ø—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–æ–≤
- üë§ **–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚è≥ **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏** - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ (–ø—Ä–∏ –≤–∫–ª—é—á–µ–Ω–Ω–æ–º FEATURE_MODERATION)
- üîç **–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫** - approve/reject workflow
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** - –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –ø–æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
- ‚≠ê **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ** - –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ª—É—á—à–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
- üóÇÔ∏è **–ê—Ä—Ö–∏–≤–∞—Ü–∏—è** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ:

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ë–î
from core.database.migrations import ensure_database_ready
ensure_database_ready()
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü

**–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `categories_v2` - –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞–≤–µ–¥–µ–Ω–∏–π
- `partners_v2` - –ø–∞—Ä—Ç–Ω–µ—Ä—ã (–≤–ª–∞–¥–µ–ª—å—Ü—ã –±–∏–∑–Ω–µ—Å–∞)
- `cards_v2` - –∫–∞—Ä—Ç–æ—á–∫–∏ –∑–∞–≤–µ–¥–µ–Ω–∏–π
- `qr_codes_v2` - QR-–∫–æ–¥—ã –¥–ª—è —Å–∫–∏–¥–æ–∫
- `moderation_log` - –∂—É—Ä–Ω–∞–ª –º–æ–¥–µ—Ä–∞—Ü–∏–∏

**Legacy —Ç–∞–±–ª–∏—Ü—ã (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏):**
- `categories` - —Å—Ç–∞—Ä—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
- `restaurants` - —Å—Ç–∞—Ä—ã–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω—ã
- `services` - —Å—Ç–∞—Ä—ã–µ —É—Å–ª—É–≥–∏

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest

# –¢–æ–ª—å–∫–æ –∫–æ–Ω—Ç—Ä–∞–∫—Ç-—Ç–µ—Å—Ç—ã
pytest tests/test_contracts.py

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º
pytest -v

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –≥—Ä—É–ø–ø—ã —Ç–µ—Å—Ç–æ–≤
pytest -m "core or api or bot"
```

### –ö–æ–Ω—Ç—Ä–∞–∫—Ç-—Ç–µ—Å—Ç—ã

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –¥–µ–ø–ª–æ–µ–º:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ callback –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
pytest tests/test_contracts.py::TestCallbackContracts

# –ü—Ä–æ–≤–µ—Ä–∫–∞ i18n –∫–ª—é—á–µ–π
pytest tests/test_contracts.py::TestI18nContracts

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ë–î —Å—Ö–µ–º—ã
pytest tests/test_contracts.py::TestDatabaseContracts
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞

### Backward Compatibility

–ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º–∞ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º –∫–æ–¥–æ–º:

1. **–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ callback –ø–∞—Ç—Ç–µ—Ä–Ω—ã**
2. **–í—Å–µ i18n –∫–ª—é—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç**
3. **Legacy —Ö–µ–Ω–¥–ª–µ—Ä—ã –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã**
4. **–°—Ç–∞—Ä–∞—è –ë–î –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è**

### –ü–æ—à–∞–≥–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

**–®–∞–≥ 1:** –ó–∞–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª—ã, –Ω–æ –æ—Å—Ç–∞–≤—å—Ç–µ —Ñ–∏—á–∞-—Ñ–ª–∞–≥–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã–º–∏
```env
FEATURE_PARTNER_FSM=false
FEATURE_MODERATION=false
FEATURE_NEW_MENU=false
```

**–®–∞–≥ 2:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

**–®–∞–≥ 3:** –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –≤–∫–ª—é—á–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

**–®–∞–≥ 4:** –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ —Ñ–∞–π–ª—ã –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–¥–∞

## üö® –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ .env —Ñ–∞–π–ª**
2. **–†–æ—Ç–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω—ã –ø—Ä–∏ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏**
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –¥–ª—è –≤–µ–±—Ö—É–∫–æ–≤**
4. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –ë–î**

### –£–¥–∞–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏ Git

–ï—Å–ª–∏ —Å–µ–∫—Ä–µ—Ç—ã –ø–æ–ø–∞–ª–∏ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ git-filter-repo
pip install git-filter-repo

# –£–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª—ã —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏
git filter-repo --path input --invert-paths
git filter-repo --path mythic-brook-414011-6b6b807faea2.json --invert-paths

# –§–æ—Ä—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ –æ–±–Ω–æ–≤–∏—Ç–µ remote
git push origin --force --all
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —É—Ä–æ–≤–Ω—è –ª–æ–≥–æ–≤
LOG_LEVEL=DEBUG  # DEBUG, INFO, WARNING, ERROR
```

### –ö–æ–º–∞–Ω–¥—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

```
/moderate - –Ω–∞—á–∞—Ç—å –º–æ–¥–µ—Ä–∞—Ü–∏—é –∫–∞—Ä—Ç–æ—á–µ–∫
/mod_stats - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏
/help - —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–æ–º–∞–Ω–¥–∞–º
```

### –ö–æ–º–∞–Ω–¥—ã –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤

```
/add_card - –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç–æ—á–∫—É
/my_cards - –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
/start - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã

1. **Non-Breaking Changes** - –Ω–∏–∫–∞–∫–∏—Ö breaking –∏–∑–º–µ–Ω–µ–Ω–∏–π
2. **Feature Flags** - –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∑–∞ —Ñ–ª–∞–≥–∞–º–∏
3. **Backward Compatibility** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ legacy –∫–æ–¥–∞
4. **Database Migrations** - –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∏—á–∞-—Ñ–ª–∞–≥ –≤ `settings.py`
2. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–π –∫–æ–¥ –∑–∞ —É—Å–ª–æ–≤–∏–µ–º —Ñ–ª–∞–≥–∞
3. –ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç-—Ç–µ—Å—Ç—ã
4. –û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
KARMABOT1-fixed/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îú‚îÄ‚îÄ database/          # –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
‚îÇ   ‚îú‚îÄ‚îÄ handlers/          # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/         # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/          # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ utils/             # –£—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ templates/             # –®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ tests/                 # –¢–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ main_v2.py            # –ù–æ–≤–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ main.py               # Legacy —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îî‚îÄ‚îÄ .env.example          # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
```

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–û—à–∏–±–∫–∞ "BOT_TOKEN is required":**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ .env —Ñ–∞–π–ª
cat .env | grep BOT_TOKEN

# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
ls -la .env
```

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
ls -la core/database/

# –£–¥–∞–ª–∏—Ç–µ –ë–î –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–π—Ç–µ
rm core/database/data.db
python main_v2.py
```

**–§–∏—á–∞-—Ñ–ª–∞–≥–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –≤ .env
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ true/false, –Ω–µ True/False
FEATURE_PARTNER_FSM=true
```

### –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

```python
# –í–∫–ª—é—á–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏
LOG_LEVEL=DEBUG

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∑–∞–ø—É—Å–∫–∞
python main_v2.py 2>&1 | grep "Feature flags"
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **Issues:** –°–æ–∑–¥–∞–≤–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –ß–∏—Ç–∞–π—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ
- **–¢–µ—Å—Ç—ã:** –ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–∏—Ü–µ–Ω–∑–∏—é –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ KARMABOT1.

---

**–í–µ—Ä—Å–∏—è:** 2.0.0  
**–î–∞—Ç–∞:** 2025-08-21  
**–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** Python 3.8+, aiogram 3.3.0+
